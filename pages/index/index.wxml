<view class="container">
  <!-- 添加服务人员入口按钮 -->
  <view class="staff-entry">
    <button class="staff-btn" bindtap="showStaffLogin">我是服务人员</button>
  </view>

  <!-- 服务人员登录弹窗 -->
  <view class="staff-modal" wx:if="{{showStaffLogin}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">服务人员登录</text>
        <icon class="close-icon" type="clear" size="20" bindtap="hideStaffLogin"/>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="label">姓名</text>
          <input class="input" 
            type="text" 
            placeholder="请输入您的姓名" 
            model:value="{{staffForm.name}}" 
            bindinput="onStaffNameInput"/>
        </view>

        <view class="form-item">
          <text class="label">手机号</text>
          <input class="input {{staffPhoneError ? 'error' : ''}}" 
            type="number" 
            placeholder="请输入手机号" 
            model:value="{{staffForm.phone}}" 
            bindinput="onStaffPhoneInput"/>
          <text class="tip error-tip" wx:if="{{staffPhoneError}}">
            手机号格式错误，请重新输入
          </text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideStaffLogin">取消</button>
        <button class="confirm-btn {{canStaffLogin ? '' : 'disabled'}}" 
          bindtap="staffLogin">登录</button>
      </view>
    </view>
  </view>

  <!-- 基础联系信息板块 -->
  <view class="form-section">
    <view class="form-item">
      <text class="label">您的姓名</text>
      <input class="input" 
        type="text" 
        placeholder="请输入姓名" 
        maxlength="50" 
        focus="{{true}}" 
        model:value="{{formData.name}}" 
        bindinput="onNameInput"/>
      <text class="tip">请填写真实姓名以便我们及时联系您</text>
    </view>

    <view class="form-item">
      <text class="label">联系电话</text>
      <input class="input {{phoneError ? 'error' : ''}}" 
        type="number" 
        placeholder="请输入联系电话" 
        model:value="{{formData.phone}}" 
        bindinput="onPhoneInput"/>
      <text class="tip {{phoneError ? 'error-tip' : ''}}">
        {{phoneError ? '号码格式错误，请重新输入' : '确保号码准确无误，方便维修人员沟通'}}
      </text>
    </view>
  </view>

  <!-- 设备信息板块 -->
  <view class="form-section">
    <!-- 设备类型选择 -->
    <view class="form-item">
      <text class="label">设备类型</text>
      <picker bindchange="onDeviceTypeChange" value="{{deviceTypeIndex}}" range="{{deviceTypes}}">
        <view class="picker">
          {{deviceTypeIndex === -1 ? '请选择设备类型' : deviceTypes[deviceTypeIndex]}}
        </view>
      </picker>
    </view>

    <!-- 故障类型选择（仅在选择设备后显示） -->
    <view class="form-item" wx:if="{{deviceTypeIndex !== -1}}">
      <text class="label">故障类型</text>
      <picker bindchange="onFaultTypeChange" value="{{faultTypeIndex}}" range="{{currentFaultTypes}}">
        <view class="picker">
          {{faultTypeIndex === -1 ? '请选择故障类型' : currentFaultTypes[faultTypeIndex]}}
        </view>
      </picker>
    </view>

    <!-- 在故障类型选择后添加以下内容 -->
    <view class="form-item">
      <text class="label">故障详情描述</text>
      <textarea class="textarea" 
        placeholder="{{faultPlaceholder}}"
        maxlength="500"
        model:value="{{formData.faultDetail}}"
        bindinput="onDetailInput">
      </textarea>
      <text class="tip">{{formData.faultDetail.length}}/500字</text>
    </view>

    <!-- 添加图片上传部分 -->
    <view class="form-item">
      <text class="label">故障现场照片</text>
      <view class="upload-area">
        <view class="image-list" wx:if="{{formData.images.length > 0}}">
          <view class="image-item" wx:for="{{formData.images}}" wx:key="index">
            <image src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}"/>
            <icon class="delete-icon" type="clear" size="18" bindtap="deleteImage" data-index="{{index}}"/>
          </view>
        </view>
        <view class="upload-btn" bindtap="uploadImages" wx:if="{{formData.images.length < 4}}">
          <text class="icon">+</text>
          <text class="tip">上传照片</text>
        </view>
      </view>
      <text class="tip">最多上传4张照片，便于维修人员了解故障情况</text>
    </view>
  </view>
</view> 